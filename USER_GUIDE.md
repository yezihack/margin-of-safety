# Margin 入门手册

欢迎使用 Margin 投资组合管理工具！本手册将详细介绍所有功能和使用技巧。

## 目录

1. [快速入门](#快速入门)
2. [资产管理](#资产管理)
3. [再平衡功能](#再平衡功能)
4. [历史记录](#历史记录)
5. [设置选项](#设置选项)
6. [安全与隐私](#安全与隐私)
7. [常见问题](#常见问题)

---

## 快速入门

### 首次启动

1. **设置主密码**
   - 首次启动时，系统会要求设置主密码
   - 密码用于加密您的资产金额数据
   - 请牢记密码，忘记后无法恢复数据
   - 建议使用 8 位以上的强密码

2. **登录界面**
   - 输入密码后点击"解锁"或按回车键
   - 密码错误会提示重新输入
   - 支持自动锁屏功能（可在设置中配置）

### 界面布局

应用主界面分为四个主要标签页：

- **📊 资产管理** - 添加、编辑、删除资产
- **⚖️ 再平衡** - 查看配置建议和历史记录
- **📈 投资组合分析** - 查看资产分布和市场指数
- **⚙️ 设置** - 配置应用选项和管理数据

---

## 资产管理

### 添加资产

1. **输入基金代码**
   - 在"基金代码"输入框中输入 6 位基金代码
   - 例如：`000001`（华夏成长）、`110035`（易方达双债增强）

2. **自动查询信息**
   - 点击"查询"按钮
   - 系统自动从天天基金网获取基金名称和类型
   - 基金类型自动识别：
     - 包含"股票"、"指数"、"混合"关键词 → 股票型
     - 包含"债券"、"债"、"纯债"、"货币"关键词 → 债券型

3. **填写金额和来源**
   - 输入持有金额（自动聚焦到金额输入框）
   - 选择资产来源（如：招商银行、支付宝等）
   - 可手动调整基金类型（如果自动识别不准确）

4. **保存资产**
   - 点击"保存"按钮
   - 系统使用 AES-256 加密金额后存储

### 编辑资产

1. 在资产列表中找到要编辑的资产
2. 点击"编辑"按钮
3. 修改类型、来源或金额
4. 点击"保存"确认修改

### 删除资产

1. 点击资产行的"删除"按钮
2. 确认删除操作
3. 资产将从数据库中永久删除

### 资产类型说明

**股票型资产**：

- 股票基金
- 指数基金（包括海外指数）
- 混合型基金（偏股、平衡等）

**债券型资产**：

- 债券基金
- 纯债基金
- 货币基金

---

## 再平衡功能

### 什么是再平衡？

再平衡是指定期调整资产配置，使其回到目标比例。这是格雷厄姆"安全边际"策略的核心：

- **市场上涨时**：股票比例上升 → 卖出股票，买入债券（高卖）
- **市场下跌时**：股票比例下降 → 卖出债券，买入股票（低买）

### 选择投资策略

系统提供三种预设策略：

#### 🛡 极度防御型（25% 股票 / 75% 债券）

**适合人群**：

- 投资新手
- 心理承受能力较弱
- 临近退休或需要稳定收入

**特点**：

- 波动最小
- 收益相对保守
- 安全性最高

#### ⚖️ 平衡型（50% 股票 / 50% 债券）

**适合人群**：

- 大多数投资者
- 格雷厄姆推荐的经典配置

**特点**：

- 风险收益平衡
- 再平衡效果最明显
- 长期表现稳健

#### ⚔️ 进取型（70% 股票 / 30% 债券）

**适合人群**：

- 有投资认知
- 纪律性强
- 能承受较大波动

**特点**：

- 潜在收益较高
- 波动较大
- 需要更强的心理素质

### 自定义比例

如果预设策略不符合您的需求，可以使用滑块自定义股票比例（0-100%）。

### 查看再平衡建议

系统会实时计算并显示：

1. **当前资产状况**
   - 总资产金额
   - 当前股票/债券比例
   - 各类资产金额

2. **目标配置**
   - 目标股票/债券比例
   - 目标金额分配

3. **再平衡建议**
   - 是否需要调整
   - 具体操作步骤（买入/卖出金额）
   - 操作原因说明

### 再平衡触发条件

当实际比例与目标比例偏差超过 **0.01%** 时，系统会提示需要再平衡。

例如：

- 目标：50% 股票 / 50% 债券
- 当前：48.76% 股票 / 51.24% 债券
- 偏差：1.24% > 0.01% → **需要再平衡**

### 记录再平衡操作

完成再平衡后：

1. 点击"✅ 我已完成再平衡"按钮
2. 在弹出对话框中填写备注（可选）
3. 点击"保存"

系统会记录：

- 再平衡时间
- 平衡前比例
- 目标比例
- 总金额
- 各类资产金额
- 备注信息

---

## 历史记录

### 查看历史记录

在"再平衡"标签页下方可以看到：

1. **历史趋势图表**
   - 红色线：股票比例变化
   - 青绿色线：债券比例变化
   - 鼠标悬停查看具体数值

2. **历史记录表格**
   - 平衡时间
   - 平衡前比例
   - 目标比例
   - 总金额
   - 距今时间
   - 备注

### 删除历史记录

点击记录行的"删除"按钮，确认后删除。

---

## 设置选项

### 指数显示设置

在"投资组合分析"页面可以显示市场指数：

- 上证指数（000001）
- 沪深300（000300）
- 标普500（SPX）
- 纳斯达克（NDX）

**配置方法**：

1. 进入"设置"标签页
2. 在"指数显示设置"中勾选要显示的指数
3. 最多选择 3 个指数
4. 设置自动保存

### 数据库信息

查看数据库相关信息：

- **存储路径**：数据库文件位置
- **文件大小**：当前数据库大小
- **最后修改**：最后一次修改时间
- **状态**：数据库是否已创建

**备份数据库**：

1. 点击"备份数据库"按钮
2. 选择保存位置
3. 系统会复制数据库文件到指定位置

### 安全设置

#### 自动锁屏

配置无操作自动锁屏时间：

- 使用滑块选择 0-30 分钟
- 0 表示永不自动锁屏
- 默认 5 分钟

**监听的用户活动**：

- 鼠标移动
- 键盘输入
- 鼠标点击
- 页面滚动

#### 立即锁屏

点击"立即锁屏"按钮，应用立即锁定，需要重新输入密码。

#### 退出登录

点击"退出登录"按钮，清除登录状态并返回登录页面。

### 来源管理

管理资产来源（如银行、券商等）：

1. **添加来源**
   - 输入来源名称（如：招商银行）
   - 点击"添加"按钮

2. **删除来源**
   - 点击来源行的"删除"按钮
   - 确认删除

### 系统信息

查看应用系统信息：

- 软件版本
- 构建日期
- 操作系统
- 系统架构
- Go 版本

---

## 安全与隐私

### 数据加密

**金额加密**：

- 使用 AES-256-GCM 加密算法
- 每个用户有独立的加密密钥
- 密钥存储在本地数据库中

**密码存储**：

- 使用 bcrypt 哈希算法
- 不存储明文密码
- 无法反向解密

### 数据存储位置

数据库文件存储在用户主目录的隐藏文件夹中：

```
Windows: C:\Users\<用户名>\.marginofsafety\
macOS:   /Users/<用户名>/.marginofsafety/
Linux:   /home/<用户名>/.marginofsafety/
```

> 💡 **备份提示**: 复制整个 `.marginofsafety` 目录即可备份所有数据（包含 margin.db 数据库文件）

### 数据备份建议

1. **定期备份**：建议每月备份一次数据库
2. **多地备份**：将备份文件保存到云盘或移动硬盘
3. **验证备份**：定期检查备份文件是否完整

### 隐私保护

- ✅ 所有数据存储在本地，不上传到任何服务器
- ✅ 不收集任何用户信息
- ✅ 不包含任何追踪代码
- ✅ 开源代码，可自行审计

---

## 常见问题

### Q1: 忘记密码怎么办？

**A**: 很遗憾，密码无法找回。如果忘记密码，只能删除数据库文件重新开始。建议：

- 使用密码管理器保存密码
- 定期备份数据库文件

### Q2: 如何更改密码？

**A**: 当前版本不支持更改密码。如需更改，需要：

1. 备份当前数据库
2. 删除数据库文件
3. 重新设置密码
4. 手动重新添加资产

### Q3: 基金类型识别错误怎么办？

**A**: 可以手动修改：

1. 在添加/编辑资产时
2. 点击"类型"下拉框
3. 选择正确的类型（股票或债券）

### Q4: 为什么有些基金查询不到？

**A**: 可能的原因：

- 基金代码输入错误
- 基金已停止运作
- 网络连接问题
- 天天基金网数据未更新

解决方法：

- 检查基金代码是否正确
- 手动输入基金名称和类型

### Q5: 再平衡频率建议？

**A**: 根据格雷厄姆的建议：

- **最少**：每年一次
- **推荐**：每季度一次
- **最多**：每月一次

过于频繁的再平衡会增加交易成本。

### Q6: 如何在多台电脑上使用？

**A**:

1. 在原电脑上备份数据库文件
2. 将备份文件复制到新电脑的数据存储位置
3. 在新电脑上启动应用
4. 使用相同的密码登录

### Q7: 应用占用多少空间？

**A**:

- 应用程序：约 30-50 MB
- 数据库文件：初始约 100 KB，随使用增长
- 总计：通常不超过 100 MB

### Q8: 支持哪些操作系统？

**A**:

- ✅ Windows 10/11 (64-bit)
- ✅ macOS 10.15+ (Intel & Apple Silicon)
- ✅ Linux (主流发行版)

### Q9: 数据会同步到云端吗？

**A**: 不会。所有数据仅存储在本地，不会上传到任何服务器。

### Q10: 如何卸载应用？

**A**:

1. 删除应用程序文件
2. 如需删除数据，删除 `~/.marginofsafety` 文件夹

---

## 投资理念

### 安全边际

本应用基于本杰明·格雷厄姆的"安全边际"理念：

> "投资的秘诀不在于评估一个行业对社会的影响有多大，或它的发展前景有多好，而在于一家公司到底值多少钱，你用多少钱买它。"

### 再平衡的价值

再平衡策略的核心价值：

1. **纪律性**：强制执行"低买高卖"
2. **风险控制**：保持资产配置在目标范围
3. **情绪管理**：避免追涨杀跌
4. **长期收益**：历史数据显示可提升 0.5-1% 年化收益

### 推荐阅读

- 《聪明的投资者》- 本杰明·格雷厄姆
- 《漫步华尔街》- 伯顿·马尔基尔
- 《投资最重要的事》- 霍华德·马克斯

---

## 技术支持

### 问题反馈

如遇到问题或有功能建议，请：

1. 查看本手册的"常见问题"部分
2. 检查是否是最新版本
3. 提交 Issue 到项目仓库

### 更新日志

查看 `CHANGELOG.md` 了解版本更新内容。

---

**免责声明**：本工具仅用于资产配置管理，不构成任何投资建议。投资有风险，决策需谨慎。使用本工具产生的任何投资损失，开发者不承担责任。
